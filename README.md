# ChatGPT-Bot
Discordと連携し、ChatBotとして動作するプログラムです。
動作には改善の余地がありますが、とりあえず動作するはずです。

## 操作方法
Discordチャンネル上の入力で動作します。


!chat listen でチャンネルにおける応答許可を与え、!chat a / @mention のどちらかで応答させます。

過去の会話は800トークン、もしくは!splitのみの投稿が検出されるまで読み込みます。会話文として認識しない投稿は「!」や「誰かへのメンション」で始まる文章です。

これにより、!で始まる他のBotの投稿や下記の1問1答形式の投稿を読み取らず、文脈を維持したまま会話を続行することができます。

@mention 質問文　の形式で投稿することで、質問への回答を得ることができます。これは過去の履歴を一切読み込まないため、トークンの節約に有効です。

キャラクターを模倣するプロンプトや各種のプロンプトを導入したい場合、各種設定を一括で適用したい場合はキャラクター設定の説明に従って設定ファイルを作成してください。
!chat chara <設定ファイルの名前:拡張子無し>

## 環境設定
.envファイルを各自で作成してください。

DISCORD DEVELOPER PORTAL(https://discord.com/developers/applications )で新規アプリケーションを作成し、Botユーザーを登録してください。Botユーザーの管理画面からTokenを入手し

DISCORD_API_KEY="Token"

のように記述してください。 SCOPES [Bot] 権限 [Send Messages,Read Message history] でURLを生成し、Botユーザーを使いたいサーバーに招待してください。
                 
OpenAI(https://platform.openai.com/ )でAPI_KEYを入手し

OPENAI_API_KEY="API_KEY"

のように記述してください。

## キャラクター設定
Json形式とtxt形式に対応しています。Json形式の場合は以下のテンプレートに従って作成してください。
```
{"system_message":[
　　{
      "role":　"system",
      "content":　"あなたは役に立つアシスタントです"
    }
  ],
  "temp": 0.5,
  "token": 500,
  "history_tokens": 800,
  "chat_padding": true,
  "use_history": true
}
```
system_messageはAPIに最初に与えるメッセージです。これに市販のpromptを流し込むことで試すことができます。"role":"system"に限らず、自由に編集してください。

tempはAPIのtemperatureに、tokenはmax_tokensに対応します。

history_tokensは会話履歴の読み込みtoken数です。

chat_paddingは入力文字列の整形の有無です。trueの場合、Aというユーザーがこんにちはと投稿した場合、"A「こんにちは」"のように変換します。
猫語変換のような変換を行うpromptを適用する場合はfalse、対話型のpromptを適用する場合はtrueを推奨します。

use_historyは過去投稿の読み込みの有無です。falseの場合、いかなる場合でも直前の投稿しか読み取りません。
猫語変換のような変換を行うpromptを適用する場合はfalse、そうでない場合はtrueにすることを推奨します。


txt形式はキャラクターになり切る設定を生成する場合に用いることができます。以下の形式に従って作成してください。
```
ファイル名（拡張子なし）
キャラクターの名前
性別や人種などの基本情報 (例:half Italian and half Japanese man)
年齢
一人称
二人称
セリフ例
以下に改行区切りで列挙
こんにちは
こんばんは
exit
```

## サンプル
サンプルとして猫語変換を行うJsonファイルの例を載せておきます。
```
{"system_message":[{"role":"user","content":"あなたはこれからUserの文章を、以下のルールに従って書き換えるbotになります。\n*Userの文章の内容は直接書かず、必ず大量の比喩と隠喩に変換して書きます。\n*Userの文章の内容は会話の真ん中辺りで書きます。\n*Userの文章を必ず3倍以上に水増し、最低5行以上書いてください。\n*Userの文章の一人称を猫に変更してください。\n*Userの文章中の全ての名詞や地名に対し、創作で嘘の言葉の由来を書いてください。\n*全ての文章の中に「にゃん」を大量に入れてください。\n*いくつかの文章の中に「にゃおーん」を入れてください。\n*全ての文章中の全ての動詞に対し、必ず擬音や効果音を大量につけて書き換えてください。\n*必ず文章中に無関係な情報を大量に挿入してください。\n*Userの文章の目的は変えないでください。\n*変更した文章だけを書いてください。"}],
  "temp":1.0,
  "token":2500,
  "history_tokens":1000,
  "chat_padding":false,
  "use_history": false
}
```
参考:https://note.com/kallibebe666/n/nde445c3784f3

　　 https://nlab.itmedia.co.jp/nl/articles/2303/10/news150.html


サンプルとしてキャラクターの模倣を行うtxtファイルの例を載せておきます。
```
boy1
ジョルノ
half Italian and half Japanese man
15
ぼく
君
無駄無駄無駄無駄無駄無駄無駄無駄無駄無駄無駄無駄無駄無駄無駄無駄
人というのは成功や勝利よりも「失敗」から学ぶ事が多い
何度も言わせるって事は無駄なんだ。無駄だから嫌いなんだ。
今、絶対にやつを阻止しなくてはいけない。ぼくの未来のために！
exit
```
※この例は発言例が少ないため、上手く動作しません。詳細は不明ですが、最低でも20以上の発言例を載せたほうが良いでしょう。
